<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calend√°rio IPTV ‚Äî Popup</title>
  <style>
    body{font-family:system-ui; margin:0; background:#0f1724; color:#e6eef6}
    .calendar{max-width:800px;margin:20px auto;padding:10px}
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .cell{min-height:80px;border:1px solid #ffffff10;border-radius:8px;padding:6px;cursor:pointer;position:relative;transition:0.15s}
    .cell:hover{background:#ffffff05}
    .cell .date{font-size:14px;font-weight:600}
    .count{position:absolute;right:6px;top:6px;background:#06b6d4;color:#001;padding:2px 6px;border-radius:20px;font-size:10px}

    .modal-bg{display:none;position:fixed;inset:0;background:#0008;backdrop-filter:blur(3px);align-items:center;justify-content:center;animation:fadeIn .25s ease}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}

    .modal{background:#0b1220;padding:16px;border-radius:14px;width:90%;max-width:380px;animation:pop .3s ease}
    @keyframes pop{0%{transform:scale(.7);opacity:0}100%{transform:scale(1);opacity:1}}

    input,textarea,button{width:100%;margin-top:8px;padding:10px;border-radius:8px;background:#ffffff05;border:1px solid #ffffff20;color:#fff;font-size:15px}
    button{cursor:pointer}
    .btn-primary{background:#06b6d4;color:#000;font-weight:600;border:0}
    .btn-del{background:#ff4747;color:#fff;border:0;margin-top:4px}

    .item-box{border:1px solid #ffffff15;padding:8px;border-radius:8px;margin-top:8px;background:#ffffff05}
    .item-head{display:flex;justify-content:space-between;align-items:center;font-size:15px;font-weight:600}
    .icon{margin-right:6px}
  </style>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1a73e8">
</head>
<body>

  <div class="calendar">
    <h2 id="monthLabel"></h2>
    <div class="cal-grid" id="dayNames"></div>
    <div class="cal-grid" id="cells"></div>
  </div>

  <!-- MODAL -->
  <div class="modal-bg" id="modalBg">
    <div class="modal">
      <h3 id="modalDate"></h3>
      <form id="clientForm">
        <input id="clientName" placeholder="üë§ Nome"/>
        <input id="clientApp" placeholder="üì∫ App"/>
        <input id="clientMAC" placeholder="üîå MAC"/>
        <input id="clientKey" placeholder="üîë Key"/>
        <textarea id="clientNote" rows="3" placeholder="üìù Observa√ß√µes"></textarea>
        <button class="btn-primary" type="submit">Salvar Cliente</button>
        <button type="button" onclick="closeModal()">Fechar</button>
      </form>

      <div id="clientList" style="margin-top:15px;font-size:14px"></div>
    </div>
  </div>

<script>
const dayNames = ['Dom','Seg','Ter','Qua','Qui','Sex','S√°b'];
const dayNamesEl = document.getElementById('dayNames');
const cellsEl = document.getElementById('cells');
const monthLabel = document.getElementById('monthLabel');
const modalBg=document.getElementById('modalBg');
const modalDate=document.getElementById('modalDate');
const clientList=document.getElementById('clientList');
let view=new Date();
let selected=null;

function keyForDate(d){return `iptv:${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`}
function load(d){return JSON.parse(localStorage.getItem(keyForDate(d))||"[]")}
function save(d,a){localStorage.setItem(keyForDate(d),JSON.stringify(a))}

function renderCalendar(){
  dayNamesEl.innerHTML="";
  dayNames.forEach(n=>{const e=document.createElement('div');e.textContent=n;e.style.textAlign='center';dayNamesEl.appendChild(e)});

  cellsEl.innerHTML="";
  const start=new Date(view.getFullYear(),view.getMonth(),1);
  const end=new Date(view.getFullYear(),view.getMonth()+1,0);
  monthLabel.textContent=start.toLocaleString('pt-BR',{month:'long',year:'numeric'});

  const offset=start.getDay();
  const total=offset+end.getDate();
  const rows=Math.ceil(total/7);
  let day=1-offset;

  for(let i=0;i<rows*7;i++){
    const c=document.createElement('div');c.className='cell';
    if(day>=1 && day<=end.getDate()){
      const d=new Date(view.getFullYear(),view.getMonth(),day);
      const dt=document.createElement('div');dt.className='date';dt.textContent=day;c.appendChild(dt);
      const arr=load(d);
      if(arr.length>0){const b=document.createElement('div');b.className='count';b.textContent=arr.length;c.appendChild(b)}
      c.onclick=()=>openModal(d);
    }
    cellsEl.appendChild(c);
    day++;
  }
}

function openModal(d){
  selected=d;
  modalDate.textContent="üìÖ " + d.toLocaleDateString('pt-BR');
  renderClients();
  modalBg.style.display='flex';
}
function closeModal(){modalBg.style.display='none'}

function renderClients(){
  const arr=load(selected);
  if(arr.length===0){clientList.innerHTML='<div>Nenhum cliente.</div>';return}

  clientList.innerHTML = arr.map((c,i)=>`
    <div class='item-box'>
      <div class='item-head'>
        <span>üë§ ${c.name}</span>
        <button class='btn-del' onclick='delClient(${i})'>üóëÔ∏è</button>
      </div>
      <div>üì∫ App: ${c.app||''}</div>
      <div>üîå MAC: ${c.mac||''}</div>
      <div>üîë Key: ${c.key||''}</div>
      ${c.note?`<div>üìù ${c.note}</div>`:''}
    </div>
  `).join('');
}

function delClient(i){
  const arr=load(selected);
  arr.splice(i,1);
  save(selected,arr);
  renderClients();
  renderCalendar();
}

document.getElementById('clientForm').onsubmit=function(e){
  e.preventDefault();
  const arr=load(selected);
  arr.push({
    name:clientName.value,
    app:clientApp.value,
    mac:clientMAC.value,
    key:clientKey.value,
    note:clientNote.value,
    created:Date.now()
  });
  save(selected,arr);
  this.reset();
  renderClients();
  renderCalendar();
};

renderCalendar();
</script>
  <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js")
      .then(() => console.log("SW registrado"))
      .catch(err => console.log("Erro SW:", err));
  }
  </script>
</body>
</html>
